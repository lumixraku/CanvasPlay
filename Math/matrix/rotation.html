<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>

<body>
    <script type="importmap">
{
  "imports": {
    "pixi.js": "/public/pixi@8.1.1.mjs"
  }
}
</script>
    
    <script type="module">
        import { DEG_TO_RAD, Graphics, Matrix, Application } from 'pixi.js';
        import { matrixMultiplyFlat , convertPixiMatrixTo4x4 } from '/Math/utils.js';

        // 创建舞台和渲染器
        const app = new Application();
        await app.init({ width: 500, height: 500 });
        // 渲染应用程序
        document.body.appendChild(app.canvas);


        {

            // 添加一个图形
            const graphics = new Graphics();
            graphics.rect(40, 40, 20, 20); // 绘制一个矩形
            graphics.fill(0xFF0000);
            app.stage.addChild(graphics);

            // 计算图形的中心点坐标
            let centerX = 50;
            let centerY = 50;
            // 定义旋转角度（以弧度为单位）
            let rotation = 0;
            // 创建一个动画循环
            app.ticker.add(() => {

                // 每一帧旋转一度
                rotation += DEG_TO_RAD; // 将角度转换为弧度
                // 创建一个矩阵并应用旋转和平移变换
                const matrix = new Matrix();

                // https://www.bilibili.com/video/BV1X7411F744/?p=3&share_source=copy_web&vd_source=76c6f2759e5467105ef75ed3ec3b58ce&t=3240
                //  translate center to origin
                // matrix.translate(-centerX, -centerY); // 移动 rotate center 到 origin 位置
                // matrix.rotate(rotation);
                // matrix.translate(centerX, centerY); // 平移到旋转点
                // 上面语句可以简写为
                matrix.translate(-centerX, -centerY).rotate(rotation).translate(centerX, centerY)

                // 也可以使用下面的表达形式
                // 注意顺序! 实际上是最后一个 append 的矩阵变换最先执行
                // matrix
                //     .append(new PIXI.Matrix(1, 0, 0, 1, centerX, centerY))
                //     .append(new PIXI.Matrix().rotate(rotation))
                //     .append(new PIXI.Matrix(1, 0, 0, 1, -centerX, -centerY))                

                // 将矩阵应用于图形的变换
                graphics.setFromMatrix(matrix);

            });
        }

        {
            // 创建一个矩形
            let rect = new Graphics();
            rect.rect(100, 100, 100, 100);
            rect.fill(0xFFFF00);

            // 添加矩形到舞台
            app.stage.addChild(rect);

            // 旋转中心
            let rotationCenterX = 250;
            let rotationCenterY = 250;
            let angle = 0;

            // 旋转动画
            app.ticker.add((delta) => {
                angle += DEG_TO_RAD; // 将角度转换为弧度

                // 创建一个新的矩阵
                let matrix = new Matrix();

                // 平移到旋转中心
                matrix.translate(-rotationCenterX, -rotationCenterY);

                // 应用旋转
                matrix.rotate(angle);

                // 回到原来的位置
                matrix.translate(rotationCenterX, rotationCenterY);

                // 应用矩阵到矩形
                rect.setFromMatrix(matrix);
            });
        }

    </script>
</body>

</html>