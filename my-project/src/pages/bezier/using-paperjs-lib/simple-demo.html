<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
        canvas {
            width: 100%;
            height: 400px;
            border: 1px solid #ccc;
        }
    </style>
    <script src="/public/paper-full.js"></script>
</head>
<body>
    <canvas id="myCanvas"></canvas>
    <script>


    paper.install(window);
    window.onload = function () {
        paper.setup('myCanvas');

        // Define the start and end points of the curve
        var startPoint = new Point(100, 150);
        var endPoint = new Point(400, 150);

        // Define the control points
        var controlPoint1 = new Point(150, 50);
        var controlPoint2 = new Point(350, 250);

        var handleLine1 = new paper.Path({
            segments: [startPoint, controlPoint1],
            strokeColor: 'red',
            dashArray: [4, 4]
        });
        var handleLine2 = new paper.Path({
            segments: [endPoint, controlPoint2],
            strokeColor: 'red',
            dashArray: [4, 4]
        });        
        // Create path for the bezier curve
        var bezierPath = new Path({
            segments: [startPoint, endPoint],
            // segments: [startPoint, controlPoint1, controlPoint2, endPoint],
            strokeColor: 'black'
        });

        // Set the control handles for the curve
        bezierPath.segments[0].handleOut = controlPoint1.subtract(startPoint);
        bezierPath.segments[1].handleIn = controlPoint2.subtract(endPoint);

        // Create draggable handles for the control points
        function createHandle(point, handleLine) {
            var handle = new Path.Circle({
                center: point,
                radius: 8,
                fillColor: 'red'
            });
            handle.draggable = true;
            handle.on('mousedrag', function (event) {
                handle.position = handle.position.add(event.delta);
                // controlPoint1.position = handle.position;
                handleLine.segments[1].point = handle.position;
                updateCurve();
            });
            return handle;
        }

        var handle1 = createHandle(controlPoint1, handleLine1);
        var handle2 = createHandle(controlPoint2, handleLine2);

        // Function to update the bezier curve based on handles' positions
        function updateCurve() {
            bezierPath.segments[0].handleOut = handle1.position.subtract(bezierPath.segments[0].point);
            bezierPath.segments[1].handleIn = handle2.position.subtract(bezierPath.segments[1].point);
            
        }

        // Initial update of the curve
        updateCurve();
    }
    </script>
</body>
</html>