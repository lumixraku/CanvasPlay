<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Interactive Bezier Curve with Paper.js</title>
    <script src="/public/paper-full.js"></script>
    <style>
        canvas {
            width: 100%;
            height: 400px;
            border: 1px solid #ccc;
        }
    </style>
</head>

<body>
    <canvas id="myCanvas"></canvas>
    <script>

    window.onload = function () {
        // Setup paper.js on the canvas
        paper.setup(document.getElementById('myCanvas'));

        // Create a new path
        var path = new paper.Path({
            strokeColor: 'black',
            strokeWidth: 2,
            segments: [[100, 100], [300, 100]]
        });

        // Add handles to the segments for the bezier curve
        path.segments[0].handleOut = new paper.Point(100, -50);
        path.segments[1].handleIn = new paper.Point(-100, 50);

        // Create visual handles
        var handle1 = new paper.Path.Circle({
            center: path.segments[0].point.add(path.segments[0].handleOut),
            radius: 5,
            fillColor: 'red'
        });

        var handle2 = new paper.Path.Circle({
            center: path.segments[1].point.add(path.segments[1].handleIn),
            radius: 5,
            fillColor: 'red'
        });

        // Create lines to show the handles
        var handleLine1 = new paper.Path({
            segments: [path.segments[0].point, handle1.position],
            strokeColor: 'blue'
        });

        var handleLine2 = new paper.Path({
            segments: [path.segments[1].point, handle2.position],
            strokeColor: 'blue'
        });

        // Function to update handles and lines
        function updateHandles() {
            handle1.position = path.segments[0].point.add(path.segments[0].handleOut);
            handle2.position = path.segments[1].point.add(path.segments[1].handleIn);
            handleLine1.segments[1].point = handle1.position;
            handleLine2.segments[1].point = handle2.position;
        }

        // Dragging functionality
        [handle1, handle2].forEach((handle, index) => {
            handle.onMouseDrag = function (event) {
                handle.position = event.point;
                if (index === 0) {
                    path.segments[0].handleOut = event.point.subtract(path.segments[0].point);
                } else {
                    path.segments[1].handleIn = event.point.subtract(path.segments[1].point);
                }
                updateHandles();
            };
        });

        // Draw the initial state
        paper.view.draw();
    };        
    </script>
</body>

</html>