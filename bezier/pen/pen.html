<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        canvas {
            width: 100%;
            height: 400px;
            border: 1px solid #ccc;
        }
    </style>
    <title>Document</title>
</head>

<body>
    <canvas id="myCanvas"></canvas>
    <script src="/public/paper-full.js"></script>
    </script>
    <script type="module">
        paper.setup('myCanvas');

        const recKeyPoints = [];
        let startPoint = null; // 记录点击位置的起点
        let endPoint = null;
        let dashLine = null; // 虚线路径

        // click & drag 
        {

            // 监听鼠标点击事件
            function onMouseDown(event) {
                // 绘制一个点
                var point = new paper.Point(event.point.x, event.point.y);
                var circle = new paper.Path.Circle(point, 5);
                circle.fillColor = 'black';
                
                dashLine = new paper.Path();
                dashLine.strokeColor = 'black';
                dashLine.dashArray = [5, 5]; // 设置虚线样式
                
                startPoint = point;    
                endPoint = point;
                dashLine.add(startPoint); // 起点                
                dashLine.add(endPoint);         
                recKeyPoints.push(point);
            }

            // 监听鼠标拖拽事件
            function onMouseDrag(event) {
                endPoint = event.point; // 更新终点位置
                // 更新点的位置
                if (startPoint) {
                    let lastOne = dashLine.segments.length -1;
                    // if(dashLine._segments.length > 1){
                    //     let lastOne = dashLine._segments.length;
                    //     dashLine.removeSegment(lastOne); // 移除之前的终点
                    // }
                    // dashLine.add(event.point); // 更新终点
                    dashLine.segments[lastOne].point = endPoint;
                }
                // dashLine.segments[1].point = endPoint; // 更新线段的终点
            }

            // 监听鼠标Up事件
            function onMouseUp(event) {
                // 更新点的位置
                var point = new paper.Point(event.point.x, event.point.y);
                var circle = new paper.Path.Circle(point, 5);
                circle.fillColor = 'black';
            }            

            // 绑定事件处理程序
            paper.view.onMouseDown = onMouseDown;
            paper.view.onMouseDrag = onMouseDrag;
            paper.view.onMouseUp = onMouseUp;
            
        }
    </script>
</body>

</html>