<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>

    <style>
        * {
            margin: 0;
            padding: 0;
        }
    </style>
</head>

<body>
    <script type="importmap">
        {
            "imports": {
                "three": "https://unpkg.com/three@0.156.0/build/three.module.js",
                "three/": "https://unpkg.com/three@0.156.0/"
            }
        }
    </script>
    <script type="module">
        import * as THREE from 'three';
        import { OrbitControls } from 'three/examples/jsm/controls/OrbitControls.js';
        import { FontLoader } from 'three/examples/jsm/loaders/FontLoader';
        import { TextGeometry } from 'three/examples/jsm/geometries/TextGeometry';
        // 创建场景
        const scene = new THREE.Scene();


        // 创建相机
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        camera.position.z = 5;
        
        // 创建渲染器
        const renderer = new THREE.WebGLRenderer();
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.body.appendChild(renderer.domElement);
        const controls = new OrbitControls(camera, renderer.domElement);


        // 创建球体
        const radius = 2;
        const sphereGeometry = new THREE.SphereGeometry(radius, 32, 32);
        const sphereMaterial = new THREE.MeshBasicMaterial({ color: 0x001122, wireframe: true,linewidth: 0.5,transparent: true });
        const sphere = new THREE.Mesh(sphereGeometry, sphereMaterial);
        sphere.position.set(0, 0, 0);
        sphere.visible = false;
        scene.add(sphere);

        // 创建词云数据
        const wordData = [
            { text: 'Hello', fontSize: 24 },
            { text: 'World', fontSize: 20 },
            { text: 'Three.js', fontSize: 28 },
            { text: 'WebGL', fontSize: 22 },
            { text: 'JavaScript', fontSize: 26 },
        ];



        // 添加环境光
        const ambientLight = new THREE.AmbientLight(0xeeeeee);
        ambientLight.intensity = 1; // 0 - 1 之间的值
        scene.add(ambientLight);

        // 添加点光源
        const pointLight = new THREE.PointLight(0xffffff);
        pointLight.position.set(5, 5, 5);
        scene.add(pointLight);

        // 加载字体
        async function loadFont() {
            return new Promise((res, rej) => {
                const loader = new FontLoader();
                loader.load('/public/font/ZCOOLQingKeHuangYou-Regular.json', (font) => {
                    res(font);
                });
            })
        }


        // 创建词云
        const [textlist, poslist] = await createWordCloud(wordData, radius);
        textlist.forEach((text) => {
            scene.add(text);
        });
        poslist.forEach((pos) => {
            sphere.add(pos);
        });
        // scene.add(wordCloud);

        // 创建词云
        async function createWordCloud(data, radius) {
            const font = await loadFont();
            const group = new THREE.Group();
            const textlist = [];
            const poslist = [];
            data.forEach((item) => {
                const geometry = new TextGeometry(item.text, {
                    font: font,
                    size: item.fontSize/ 10,
                    height: 0.1,
                    curveSegments: 12,
                    bevelEnabled: true,
                    bevelThickness: 0.01,
                    bevelSize: 0.01,
                    bevelSegments: 5,
                });

                const material = new THREE.MeshBasicMaterial({ color: 0xffffff });
                const textmesh = new THREE.Mesh(geometry, material);
                textmesh.scale.set(0.1, 0.1, 0.1);
                // 计算单词在球体上的位置
                const theta = Math.random() * Math.PI;
                const phi = Math.acos(Math.random() - 0.5);
                
                const cube = createCube();
                // mesh.position.set(1, 1, 1);
                cube.position.set(
                    radius * Math.sin(phi),
                    radius * Math.cos(phi),
                    radius * Math.cos(phi)
                );
                cube.visible = false;


                // group.add(mesh); 
                poslist.push(cube);
                textlist.push(textmesh);
            });

            return [textlist, poslist];
        }


        function  createCube() {
            // 创建几何体
            const geometry = new THREE.BoxGeometry(0.1, 0.1, 0.1);

            // 创建材质
            const material = new THREE.MeshBasicMaterial({ color: 0xff0000 });

            // 创建Mesh
            const cube = new THREE.Mesh(geometry, material);
            return cube;            
        }
        // 添加动画效果
        const animate = () => {
            requestAnimationFrame(animate);
            //   sphere.rotation.x += 0.01;
            sphere.rotation.y += 0.01;
            for (let i = 0; i < poslist.length; i++) {
                const cubeWorldPosition = new THREE.Vector3();
                poslist[i].getWorldPosition(cubeWorldPosition);                
                textlist[i].position.copy(cubeWorldPosition);
            }
            renderer.render(scene, camera);
        };
        animate();

        // 监听窗口大小变化事件
        window.addEventListener('resize', handleResize);

        // 处理窗口大小变化
        function handleResize() {
            // 更新相机的 aspect 属性
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();

            // 更新渲染器的大小
            renderer.setSize(window.innerWidth, window.innerHeight);

            // 重新渲染
            renderer.render(scene, camera);
        }

    </script>
</body>

</html>